<!DOCTYPE html>
<html style="padding:0;margin:0;">
	<body style="padding:0;margin:0;overflow: hidden;">
		<canvas id="screen"></canvas>
		<script>
			function randomRange(low, high){
				var difference = high-low;
				var output = Math.random();
				output = Math.round(output*difference)+low;
				return output;
			}
			var canvas = document.getElementById('screen');
			var ctx = canvas.getContext('2d');
			function canvasResize() {
				canvas.width  = window.innerWidth;
				canvas.height = window.innerHeight;
				ctx.fillStyle = '#23272A';
				ctx.fillRect(0, 0, canvas.width, canvas.height);
			}
			canvasResize();
			window.onresize = canvasResize;
			ctx.fillStyle = 'black';
			ctx.fillRect(0, 0, canvas.width, canvas.height);
			
			//ctx.fillStyle = 'yellow';
			//ctx.beginPath();
    			//ctx.arc(canvas.width/2, canvas.height/2, 10, 0, 2 * Math.PI);
   			//ctx.fill();


			var boids = []
			var distances = []

			//function dist(bo1d, bo2d){
			//	xdist = boids[bo1d].x - boids[bo2d].x
			//	ydist = boids[bo1d].y - boids[bo2d].y
			//	return [xdist, ydist]
			//}
			function dist(bo1d){
				xdist = canvas.width/2 - bo1d.x
				ydist = canvas.height/2 - bo1d.y
				if(ydist >= 0){
					originangle = Math.atan(xdist/ydist)
					//console.log("no pi")
				} else {
					originangle = Math.atan(xdist/ydist)+Math.PI
					//console.log("+pi")
				}
				return [xdist, ydist, originangle]
			}
			function addParticlesOnClick(event){
				var x = event.clientX;
				var y = event.clientY;
				for(var i = 0; i < 4; i++){
					boid = new Boid();
					if(100>x){
						x = 100
					} else if(x>canvas.width-100) {
						x = canvas.width-100
					}
					if(100>y){
						y = 100
					} else if(y>canvas.height-100) {
						y = canvas.height-100
					}
					boid.x = x + randomRange(-50, 50)
					boid.y = y + randomRange(-50, 50)
					boids.push(boid)
					if(boids.length>80){
						boids.shift();
					}
				}
				
			}
			canvas.addEventListener('mousedown', addParticlesOnClick);

			function line(x, y, angle, length, color){
					ctx.lineWidth = 3;
					ctx.strokeStyle = color
					ctx.beginPath();
					ctx.moveTo(x, y);
					ctx.lineTo(x + length*Math.sin(angle), y + length*Math.cos(angle));
					ctx.closePath();
					ctx.stroke();
			}
			
			class Boid{
				constructor(){
					this.x = randomRange(0, canvas.width)
					this.y = randomRange(0, canvas.height)
					this.angle = 2*Math.random()*Math.PI
					this.speed = randomRange(3, 12)
					this.size = 9
				}
				draw(){
					var distance = []
					distance = dist(this)
					var xspeed = 0
					var yspeed = 0
					var xdir
					var ydir
					var originangle

					if(this.x < canvas.width/2){
						xdir = 1;
					} else {
						xdir = 1
					}
					if(this.y < canvas.height/2){
						ydir = 1;
					} else {
						ydir = 1
					}

					if(-20<this.x<canvas.width+20 && -20<this.y<canvas.height+20){
						ctx.lineWidth = 8;
						ctx.strokeStyle = 'red'
						ctx.lineJoin = 'round';
						ctx.beginPath();
						ctx.moveTo(this.x, this.y);
						ctx.lineTo(this.x+this.size*Math.sin(this.angle+1.35*Math.PI), this.y+this.size*Math.cos(this.angle+1.35*Math.PI));
						ctx.lineTo(this.x+this.size*1.3*Math.sin(this.angle), this.y+this.size*1.3*Math.cos(this.angle));
						ctx.lineTo(this.x+this.size*Math.sin(this.angle+0.65*Math.PI), this.y+this.size*Math.cos(this.angle+0.65*Math.PI));
						ctx.lineTo(this.x, this.y);
						ctx.closePath();
						ctx.stroke();

						//line(this.x, this.y, distance[2], Math.sqrt(Math.pow(distance[0], 2)+Math.pow(distance[1], 2)), 'green');
						//line(this.x, this.y, xdir*Math.PI/2, distance[0], 'yellow');
						//line(this.x, this.y, ydir*Math.PI, -distance[1], 'yellow');
					}					

					var dit = Math.sqrt(Math.pow(distance[0], 2)+Math.pow(distance[1], 2)) // distance to center
					var grav = Math.pow(Math.abs(dit/300)+1, 2) // gravity inverse square, but capped


					xspeed = this.speed * Math.sin(this.angle) + Math.sin(distance[2])/grav
					yspeed = this.speed * Math.cos(this.angle) + Math.cos(distance[2])/grav
					if(-20>xspeed>20){
						xspeed = 10
					}
					if(-20>yspeed>20){
						yspeed = 10
					}
					if(yspeed >= 0){
						//console.log("down")
						this.angle = Math.atan(xspeed/yspeed)
					} else {
						this.angle = Math.atan(xspeed/yspeed)+Math.PI
						//console.log("up")
					}
					this.speed = Math.sqrt(Math.pow(xspeed, 2)+Math.pow(yspeed, 2))
					this.x = this.x + xspeed
					this.y = this.y + yspeed
				}
			}
			setInterval(function(){
				ctx.fillStyle = '#23272A';
				ctx.fillRect(0, 0, canvas.width, canvas.height);


				for(var i = 0; i < boids.length; i++){
					boids[i].draw()
				}

			}, 20)

		</script>
	</body>
</html>